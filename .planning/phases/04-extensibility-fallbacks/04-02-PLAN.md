---
phase: 04-extensibility-fallbacks
plan: 02
type: execute
wave: 1
depends_on: ["04-01"]
files_modified:
  - README.md
  - readme.txt
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Developers can discover how to add custom post types by reading README.md"
    - "Users can discover query parameter fallback by reading README.md or readme.txt"
    - "readme.txt FAQ accurately describes current custom post type capability"
  artifacts:
    - path: "README.md"
      provides: "Developer documentation for filter hook and query parameter"
      contains: "markdown_alternate_supported_post_types"
    - path: "readme.txt"
      provides: "User documentation for query parameter fallback"
      contains: "format=markdown"
  key_links:
    - from: "README.md"
      to: "filter hook in code"
      via: "documented filter name matches code"
      pattern: "markdown_alternate_supported_post_types"
    - from: "readme.txt"
      to: "query parameter in code"
      via: "documented parameter matches implementation"
      pattern: "format=markdown"
---

<objective>
Document query parameter fallback and custom post type extensibility in user-facing documentation.

Purpose: Close documentation gaps identified in 04-VERIFICATION.md. Code is complete and working; users and developers simply cannot discover these features without documentation.

Output: Updated README.md with "Via Query Parameter" usage section and "For Developers" extensibility section; Updated readme.txt FAQ and changelog.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-extensibility-fallbacks/04-VERIFICATION.md
@README.md
@readme.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add query parameter and developer sections to README.md</name>
  <files>README.md</files>
  <action>
Update README.md to add documentation for Phase 4 features:

1. Add "Via Query Parameter" subsection after "Via Content Negotiation" in Usage section:
   ```markdown
   ### Via Query Parameter

   For clients that cannot send custom headers, use the `format` query parameter:

   ```bash
   curl https://example.com/hello-world/?format=markdown
   ```

   Note: The value must be exactly `markdown` (lowercase, case-sensitive).
   ```

2. Add new "For Developers" section after "Development" section:
   ```markdown
   ## For Developers

   ### Custom Post Type Support

   By default, only posts and pages serve markdown. To enable markdown for custom post types, use the `markdown_alternate_supported_post_types` filter:

   ```php
   add_filter( 'markdown_alternate_supported_post_types', function( $types ) {
       $types[] = 'book';      // Add your custom post type
       $types[] = 'portfolio'; // Add multiple types
       return $types;
   } );
   ```

   Once added, the custom post type will:
   - Serve markdown at `.md` URLs (e.g., `/my-book.md`)
   - Respond to `Accept: text/markdown` headers
   - Respond to `?format=markdown` query parameter
   - Include `<link rel="alternate">` tag in HTML head
   ```

3. Update Project Structure in Development section to reflect current src/ structure (optional, only if significantly outdated).
  </action>
  <verify>
1. Grep README.md for "format=markdown" - should find query parameter documentation
2. Grep README.md for "markdown_alternate_supported_post_types" - should find filter documentation
3. Grep README.md for "For Developers" - should find new section header
  </verify>
  <done>
- Query parameter fallback documented with curl example
- Filter hook documented with PHP code example
- All three access methods documented: URL, Accept header, query parameter
- Custom post type extensibility discoverable by developers reading README
  </done>
</task>

<task type="auto">
  <name>Task 2: Update readme.txt FAQ and changelog</name>
  <files>readme.txt</files>
  <action>
Update readme.txt to document Phase 4 features:

1. Update the FAQ entry "Does it work with custom post types?" to:
   ```
   = Does it work with custom post types? =

   Yes! By default, only posts and pages are supported. Developers can enable custom post types using a filter hook:

   `add_filter( 'markdown_alternate_supported_post_types', function( $types ) {
       $types[] = 'your_custom_type';
       return $types;
   } );`
   ```

2. Add new FAQ entry for query parameter:
   ```
   = What if my client cannot send Accept headers? =

   Use the `format` query parameter: `https://example.com/hello-world/?format=markdown`

   This works on any supported post URL. The value must be exactly `markdown` (lowercase).
   ```

3. Update changelog to document new features:
   ```
   = 1.0.0 =
   * Initial release
   * Support for posts and pages
   * Clean .md URL endpoints
   * Content negotiation via Accept header
   * Query parameter fallback via ?format=markdown
   * Custom post type support via filter hook
   ```
  </action>
  <verify>
1. Grep readme.txt for "format=markdown" - should find query parameter FAQ
2. Grep readme.txt for "markdown_alternate_supported_post_types" - should find updated FAQ
3. Confirm FAQ no longer says "may be added in future versions"
  </verify>
  <done>
- FAQ accurately describes current custom post type capability (filter exists NOW)
- Query parameter fallback documented in FAQ
- Changelog reflects all Phase 4 features
- No misleading "future versions" language
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify:
1. `grep -i "format=markdown" README.md readme.txt` shows documentation in both files
2. `grep "markdown_alternate_supported_post_types" README.md readme.txt` shows filter in both files
3. `grep -i "future versions" readme.txt` returns NO matches (outdated language removed)
4. README.md Usage section has three subsections: URL, Accept header, Query Parameter
5. README.md has "For Developers" section with filter hook example
</verification>

<success_criteria>
1. Gap 1 closed: Filter hook documentation exists in README.md developer section with working example
2. Gap 2 closed: Query parameter fallback documented in README.md usage section
3. readme.txt FAQ accurately reflects current capability (not "future versions")
4. Both URL-04 and TECH-05 requirements now have user-discoverable documentation
</success_criteria>

<output>
After completion, create `.planning/phases/04-extensibility-fallbacks/04-02-SUMMARY.md`
</output>
